<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>watermark demo</title>
</head>
<body style="height: 100%; width: 100%;">

  

  <script>

    const hexToRGBA = (hex, opacity = 0.8) => {
      h = hex.slice(hex.startsWith('#') ? 1 : 0);
      if (h.length === 3) h = [...h].map(x => x + x).join('');
      h = parseInt(h, 16);
      return ('rgba' + '(' + (h >>> 16) + ', ' + ((h & 0x00ff00) >>> 8) + ', ' + ((h & 0x0000ff) >>> 0) + (`, ${opacity}`) + ')');
    } 

    const text = "leipengfei6,0.0.0.0,78:4f:43:6b:b6:46,保密信息严禁外传,娃哈哈"; // 水印
    const lineSpace = 8; // 水印行间距，对于多行水印情况生效    
    const fontSize = 20; // 字体大小
    const fontFamily = "宋体"; // 字体
    const angle = -55; // 旋转角度
    const offSetX = 120; // 水平间距
    const offSetY = 120; // 垂直间距
    const opacity = 0.8; // 透明度度
    const width = 500; // 水印宽度
    const height = 500; // 水印高度

    let canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    ctx.font = `${fontSize}px ${fontFamily}`;
    ctx.textAlign = "left";
    ctx.textBaseline = "top";
    ctx.fillStyle = hexToRGBA("#123456", 0.8);

    const textArr = text.split(",");
    const len = textArr.length;
    const maxWidth = textArr.reduce((acc, cur) => ctx.measureText(cur).width > acc ? ctx.measureText(cur).width : acc, 0);
    const maxHeight = len * fontSize + (len - 1) * lineSpace;
    
    const canvasWidth = maxWidth + offSetX;
    const canvasHeight = maxHeight + offSetY;

    canvas.width = canvasWidth;
    canvas.height = canvasHeight;

    ctx.translate(canvasWidth / 2, canvasHeight / 2);
    ctx.rotate(angle * Math.PI / 180);
    ctx.translate(-canvasWidth / 2, -canvasHeight / 2);

    for (let i = 0; i < len; i++) {
      const pos =  canvasHeight / 2  - (lineSpace + fontSize) * (len - 1) / 2 + i * (fontSize + lineSpace);
      ctx.fillText(textArr[i], 0, pos);
    }

    ctx.strokeStyle = "blue";	
    ctx.strokeRect(0, 0, canvasWidth, canvasHeight);

    ctx.moveTo(0, canvasHeight / 2);
    ctx.lineTo(canvasWidth, canvasHeight / 2);
    ctx.strokeStyle = "red";
    ctx.stroke();

    
    console.log(canvas.toDataURL("image/png"));

    let div = document.createElement("div");
    div.style.pointerEvents = "none";
    div.style.background = `url(${canvas.toDataURL("image/png")}) left top repeat`;
    div.style.height = "100%";
    div.style.width = "100%";
    div.style.position = "fixed";
    div.style.zIndex = "10000";

    document.body.appendChild(div);

    


    
    


    
    
    
    

    

    

    /** 中心圆 */
    ctx.beginPath();
    ctx.arc(width / 2, height / 2, 5, 0, 2 * Math.PI);
    ctx.closePath();
    ctx.fillStyle = "red";
    ctx.fill();

    /** 中心水平线 */
    ctx.moveTo(0, height / 2);
    ctx.lineTo(width, height / 2);
    ctx.strokeStyle = "red";
    ctx.stroke();

    /** 画布框 */
    ctx.strokeStyle = "blue";	
    ctx.strokeRect(0, 0, width, height);

    

    


    
    

    
  
  </script>

</body>
</html>